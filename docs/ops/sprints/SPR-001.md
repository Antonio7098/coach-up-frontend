# Sprint SPR-001 — MVP Chat Core

Ship realtime chat streaming via SSE end-to-end: backend API route streams tokens; frontend SSE client renders and reconnects robustly.

## Meta
- Sprint ID: SPR-001
- Status: completed
- Start date: 19/08/2025
- End date: 19/08/2025
- Links: [Overview](./overview.md) · [PRD](../../planning/prd.md) · [Technical Overview](../../planning/technical-overview.md) · [Monitoring](../../ops/monitoring.md) · [Benchmarking](../../ops/benchmarking.md) · [Features CSV](../features.csv)

## Objectives (Tick when achieved)
- [x] Deliver streaming chat via SSE end-to-end (backend -> frontend)
- [x] Robust SSE client with reconnect/backoff
- [x] Basic latency metrics and logs wired for chat path

## Planned Tasks
- [x] Implement Chat API Route (/api/chat)
   - [x] Stream tokens using Web Streams/SSE
   - [x] Include requestId headers and structured logs (request ID propagated; basic structured logs pending)
- [x] Implement Realtime Chat SSE UI
   - [x] SSE client hookup and message rendering
   - [x] Input -> request pipeline with abort/cancel
- [x] Reconnect & Backoff Logic
   - [x] Exponential backoff + jitter
   - [x] Visible status (connecting/connected/retrying)

## Scope
In scope
- Chat API route that streams tokens
- Frontend SSE client and reconnect logic

Out of scope
- Auth (Clerk) integration beyond dev mode
- Provider abstraction/benchmarking (deferred to SPR-006)
- Persistent transcript storage (SPR-003)

## Features in this Sprint
List feature IDs from Features CSV (pipe-separate multiple)
- [x] FEAT-001 — Realtime Chat SSE (frontend)
- [x] FEAT-002 — Chat API Route (/api/chat) (backend)
- [x] FEAT-018 — SSE Client & Reconnect Logic (frontend)

## Acceptance Criteria
- [x] Chat messages stream incrementally to the UI via SSE
- [x] Client auto-reconnects; no user action needed for transient drops
- [x] E2E smoke passes for a full chat turn; no P0 bugs

## Risks & Mitigations
- Risk: SSE disconnects on mobile networks · Mitigation: aggressive backoff, keep-alives, smaller event payloads
- Risk: Browser compatibility issues · Mitigation: feature-detect EventSource, fallback strategy noted

## Dependencies
- Depends on features/sprints: NA
- External: NA

## Technical Details
### Database Models
- Collections/Tables impacted: NA (no persistent storage in this sprint)
- New/changed fields: NA
- Constraints/validation: NA
- Indexes (read/write paths): NA
- Migrations: NA — Backfill plan: NA
- Data retention: NA

### Algorithmic Details
- Approach: Stream-from-LLM to client via server relay; minimal buffering
- Rubric Version: NA
- Latency targets: TTFT < 1.2s; full-turn < 2.5s

### Prompts & Rubrics
- Prompt names/links: baseline chat prompt
- Judge/rubric key points: clarity of streaming, no hallucinated UI states

## QA & Testing
- [ ] Unit tests updated/added (API handler, SSE client utils) — deferred to SPR-002
- [x] E2E happy path green (Playwright)
- [ ] Load/SSE smoke test passes (k6) — deferred to SPR-002
- [ ] Contract tests for API routes — deferred to SPR-002

Notes:
- Playwright E2E added: ui/tests/chat.spec.ts; config: ui/playwright.config.ts
- Scripts: npm run test:e2e (server must be running on http://localhost:3000)
- Install once: npm i -D @playwright/test && npx playwright install
- Decision: Unit tests, contract tests, and k6 smoke are deferred to SPR-002

## Observability & SLOs
Targets (see Technical Overview §10)
- Realtime chat p95 TTFT < 1.2s; full-turn < 2.5s
- Assessment p95 completion < 8s

Checkpoints
- [ ] Dashboards exist/updated (links) — tracked in SPR-004
- [ ] Alerts configured (links) — tracked in SPR-004
- [ ] Structured logs include requestId, provider, modelId, tokens, cost, latency — tracked in SPR-004

## Issues & Deviations
Use this section to log issues encountered during the sprint, how they were resolved, and any deviations from the plan.

- Date: <YYYY-MM-DD> — Issue: <short summary> — Impact: <scope/users/services>
  - Detection: <alert/log/user report>
  - Fix: <what changed> — PR: <link> — Owner: <name>
  - Follow-up: <test/monitoring/doc action>
- Deviation from plan: <what changed and why>
 - 19/08/2025 — Deviation: Deferred unit tests, contract tests, and k6 SSE smoke to SPR-002 to keep scope tight and focus on streaming MVP delivery.

## Operational Hygiene
 - [ ] CI checks green (API Docs workflow, tests/linting) — tracked in SPR-004; E2E verified locally this sprint
 - [ ] Branch protection respected (PR + review) — N/A for local changes; enforce from SPR-002
 - [ ] Pre-commit hooks executed (lint/format/type checks) — not set up; deferred to SPR-002
 - [ ] .env.example updated if new env vars added — no new env vars introduced; N/A this sprint
  - [x] Request ID propagated end-to-end for changed paths
 - [ ] Logs include: requestId, route, userId (if available), provider, modelId, tokens, cost, latency — tracked in SPR-004
 - [ ] Rate limiting and idempotency considered for new/changed endpoints — out of scope for SPR-001; tracked in SPR-004/SPR-006

## Documentation
- [x] API reference updated for endpoints touched (Core & AI)
- [x] OpenAPI spec updated and linted
- [x] Examples added/verified (curl + TypeScript)
- [ ] Cross-links updated (PRD/Technical Overview)
Notes:
- Curl example: coach-up-ai-api/CONTRIBUTING.md (Quick SSE test)
- TypeScript example: coach-up-frontend/ui/src/app/chat/page.tsx (EventSource client)

## Post-sprint
 - [ ] KPIs reviewed; compare to targets — scheduled for retro in SPR-002
 - [ ] Retrospective completed; action items filed — scheduled for first day of SPR-002
 - [ ] Docs updated (PRD/Tech Overview/Runbooks) — major docs updated during sprint; remaining runbooks deferred to SPR-002

## Change Log
- 19/08/2025 — Created sprint page
- 19/08/2025 — AI API: Added /chat/stream SSE endpoint; added OpenAPI description, servers, tags; Spectral lint clean; Redoc built
- 19/08/2025 — AI API: Added Request ID middleware and CORS for localhost:3000; documented curl SSE test in CONTRIBUTING
- 19/08/2025 — Frontend: Scaffolded Next.js UI app under ui/; added /api/chat SSE proxy (no-CORS) with X-Request-Id propagation
- 19/08/2025 — Frontend: Implemented /chat page with SSE client, reconnect/backoff, cancel, status pill, and basic timing metrics
 - 19/08/2025 — Frontend: Proxy now forwards query parameters to AI API (supports /api/chat?prompt=…)
 - 19/08/2025 — Verified end-to-end streaming via proxy (curl and browser); acceptance criteria ticked
 - 19/08/2025 — AI API: Added server-side TTFT and total latency logging for /chat/stream; echoes X-Request-Id; accepts optional prompt param; verified via curl
 - 19/08/2025 — Frontend: Added Playwright config and minimal E2E test for /chat streaming; package.json test scripts added
 - 19/08/2025 — Frontend: Playwright E2E happy path green (streams and sees [DONE])
 - 19/08/2025 — Sprint closed (SPR-001)
 - 19/08/2025 — Decision: Deferred unit/contract tests and k6 smoke to SPR-002
